@using System.Globalization
@inject NavigationManager Nav

<div class="dropdown">
    <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        ğŸŒ @GetCurrentLanguageName()
    </button>
    <ul class="dropdown-menu dropdown-menu-end">
        @foreach (var culture in SupportedCultures)
        {
            <li>
                <a class="dropdown-item @(IsCurrentCulture(culture.Code) ? "active" : "")" 
                   href="@GetCultureChangeUrl(culture.Code)">
                    @culture.Name
                </a>
            </li>
        }
    </ul>
</div>

@code {
    private static readonly (string Code, string Name)[] SupportedCultures = new[]
    {
        ("it-IT", "ğŸ‡®ğŸ‡¹ Italiano"),
        ("en-US", "ğŸ‡¬ğŸ‡§ English")
    };

    private string GetCurrentLanguageName()
    {
        var current = CultureInfo.CurrentCulture.Name;
        return SupportedCultures.FirstOrDefault(c => c.Code == current).Name ?? "ğŸ‡®ğŸ‡¹ Italiano";
    }

    private bool IsCurrentCulture(string code) => CultureInfo.CurrentCulture.Name == code;

    private string GetCultureChangeUrl(string cultureCode)
    {
        var uri = new Uri(Nav.Uri);
        var redirectUri = uri.PathAndQuery;
        return $"/Culture/Set?culture={cultureCode}&redirectUri={Uri.EscapeDataString(redirectUri)}";
    }
}
