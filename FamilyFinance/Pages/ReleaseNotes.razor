@page "/release-notes"
@using System.Reflection
@using System.Globalization
@inject IStringLocalizer<SharedResource> L
@inject IWebHostEnvironment Env

<div class="max-w-4xl mx-auto">
    <div class="flex items-center justify-between mb-6">
        <div>
            <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-100">@L["ReleaseNotes"]</h1>
            <p class="text-sm text-gray-500 dark:text-gray-400">@L["VersionHistory"]</p>
        </div>
        <div class="px-4 py-2 bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 rounded-xl font-mono font-bold">
            v@_currentVersion
        </div>
    </div>

    <div class="space-y-8">
        @foreach (var release in _releases)
        {
            <div class="bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-800 overflow-hidden">
                <!-- Release Header -->
                <div class="px-6 py-4 bg-gradient-to-r @(release.IsMajor ? "from-primary-500 to-primary-600" : "from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700")">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">@release.Emoji</span>
                            <div>
                                <h2 class="text-xl font-bold @(release.IsMajor ? "text-white" : "text-gray-800 dark:text-gray-100")">
                                    v@release.Version
                                </h2>
                                <p class="text-sm @(release.IsMajor ? "text-primary-100" : "text-gray-500 dark:text-gray-400")">
                                    @release.Date.ToString("dd MMMM yyyy", CultureInfo.CurrentUICulture)
                                </p>
                            </div>
                        </div>
                        @if (release.IsMajor)
                        {
                            <span class="px-3 py-1 bg-white/20 text-white text-sm font-medium rounded-full">
                                @L["MajorRelease"]
                            </span>
                        }
                    </div>
                    @if (!string.IsNullOrEmpty(release.Title))
                    {
                        <p class="mt-2 @(release.IsMajor ? "text-primary-100" : "text-gray-600 dark:text-gray-300")">
                            @release.Title
                        </p>
                    }
                </div>

                <!-- Release Content -->
                <div class="p-6 space-y-6">
                    @foreach (var sect in release.Sections)
                    {
                        <div>
                            <h3 class="flex items-center gap-2 text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">
                                <span class="text-xl">@sect.Icon</span>
                                @sect.Title
                            </h3>
                            <ul class="space-y-2">
                                @foreach (var item in sect.Items)
                                {
                                    <li class="flex items-start gap-2 text-gray-600 dark:text-gray-400">
                                        <svg class="w-5 h-5 text-primary-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <span>@item</span>
                                    </li>
                                }
                            </ul>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>

@code {
    string _currentVersion = "2.0.0";
    List<ReleaseInfo> _releases = new();
    bool _isItalian => CultureInfo.CurrentUICulture.Name.StartsWith("it");

    protected override void OnInitialized()
    {
        // Get version from assembly
        var assembly = typeof(Program).Assembly;
        var version = assembly.GetCustomAttribute<AssemblyInformationalVersionAttribute>()?.InformationalVersion;
        if (!string.IsNullOrEmpty(version))
        {
            _currentVersion = version.Split('+')[0];
        }

        // Define releases based on current language
        _releases = _isItalian ? GetItalianReleases() : GetEnglishReleases();
    }

    List<ReleaseInfo> GetItalianReleases() => new()
    {
        new ReleaseInfo
        {
            Version = "2.5.0",
            Date = new DateTime(2025, 12, 21),
            Emoji = "üöÄ",
            IsMajor = true,
            Title = "Open Source Ready",
            Sections = new List<ReleaseSection>
            {
                new("üìö", "Documentazione", new List<string>
                {
                    "README.md professionale con badges e guide",
                    "CONTRIBUTING.md per contributors",
                    "Licenza MIT",
                    "Configurazione ambiente con env.example"
                }),
                new("üê≥", "DevOps", new List<string>
                {
                    "Dockerfile multi-stage ottimizzato",
                    "docker-compose.yml per deploy facile",
                    "GitHub Actions CI/CD automatico",
                    "Health check endpoint per container"
                }),
                new("üß™", "Testing", new List<string>
                {
                    "Nuovo progetto test con xUnit",
                    "25 unit test per i servizi core",
                    "Database InMemory per test isolati"
                })
            }
        },
        new ReleaseInfo
        {
            Version = "2.4.0",
            Date = new DateTime(2025, 12, 21),
            Emoji = "üìà",
            IsMajor = true,
            Title = "Proiezioni e Forecasting",
            Sections = new List<ReleaseSection>
            {
                new("üîÆ", "Strumento di Pianificazione", new List<string>
                {
                    "Analisi trend: crescita mensile media e tasso percentuale",
                    "Grafico proiezione: storico + futuro stimato (1-10 anni)",
                    "Calcolatore 'Quando raggiunger√≤?': data stimata per importo target",
                    "Timeline obiettivi con date di completamento stimate"
                }),
                new("üßÆ", "Simulatore What-If", new List<string>
                {
                    "Simula contributi mensili aggiuntivi",
                    "Calcolo valore futuro con interesse composto",
                    "Mostra crescita stimata vs contributi versati",
                    "Proiezioni fino a 20 anni"
                }),
                new("üìä", "Calcoli Finanziari", new List<string>
                {
                    "Tasso crescita composto mensile da storico",
                    "Formula annuity per contributi periodici",
                    "Proiezione logaritmica per tempo a obiettivo"
                })
            }
        },
        new ReleaseInfo
        {
            Version = "2.3.0",
            Date = new DateTime(2025, 12, 21),
            Emoji = "üìä",
            IsMajor = false,
            Title = "Confronto Mensile",
            Sections = new List<ReleaseSection>
            {
                new("üìà", "Dashboard Comparativa", new List<string>
                {
                    "Selezione di due snapshot per confronto",
                    "Cards riassuntive: patrimonio, variazione, crescita %",
                    "Grafico a barre per confronto categorie",
                    "Sezione 'Cosa √® cambiato': aumenti vs diminuzioni"
                }),
                new("üìã", "Tabelle Dettagliate", new List<string>
                {
                    "Confronto per categoria con delta e percentuali",
                    "Dettaglio per singolo account/investimento",
                    "Ordinamento automatico per importo"
                })
            }
        },
        new ReleaseInfo
        {
            Version = "2.2.0",
            Date = new DateTime(2025, 12, 21),
            Emoji = "üèóÔ∏è",
            IsMajor = true,
            Title = "Refactoring Architettura",
            Sections = new List<ReleaseSection>
            {
                new("üîß", "Architettura Servizi", new List<string>
                {
                    "Nuove interfacce service (ISnapshotService, IAccountService, etc.)",
                    "Servizi domain-specific per ogni area funzionale",
                    "FinanceService come facade per retrocompatibilit√†"
                }),
                new("üß©", "Componenti Dashboard", new List<string>
                {
                    "Nuovi componenti riutilizzabili (NetWorthCards, Charts, etc.)",
                    "Migliore separazione delle responsabilit√†",
                    "Codice pi√π manutenibile e testabile"
                }),
                new("üóëÔ∏è", "Pulizia Codice", new List<string>
                {
                    "Rimossi file demo (Counter, FetchData, Weather)",
                    "Rimossi commenti superflui",
                    "Multi-tenancy enforced con familyId obbligatorio"
                })
            }
        },
        new ReleaseInfo
        {
            Version = "2.1.1",
            Date = new DateTime(2025, 12, 21),
            Emoji = "üîß",
            IsMajor = false,
            Title = "Fix Export/Import Budget",
            Sections = new List<ReleaseSection>
            {
                new("üì¶", "Export/Import", new List<string>
                {
                    "Export JSON ora include categorie budget e spese mensili",
                    "Import preview mostra conteggio categorie budget",
                    "Import con mappatura ID corretta per le categorie",
                    "Versione formato backup aggiornata a 2.0"
                })
            }
        },
        new ReleaseInfo
        {
            Version = "2.1.0",
            Date = new DateTime(2025, 12, 21),
            Emoji = "üí∞",
            IsMajor = false,
            Title = "Budget & Spese Mensili",
            Sections = new List<ReleaseSection>
            {
                new("üìä", "Sistema Budget", new List<string>
                {
                    "Nuova pagina Gestione Budget per categorie di spesa",
                    "Categorie predefinite con un click (Casa, Alimentari, Trasporti...)",
                    "Budget mensile configurabile per categoria",
                    "Icone emoji e colori personalizzabili"
                }),
                new("üí≥", "Tracciamento Spese", new List<string>
                {
                    "Sezione Spese del Mese nello SnapshotEdit",
                    "Barra di progresso per ogni categoria",
                    "Evidenziazione visiva quando si supera il budget",
                    "Tab Budget nella Dashboard con riepilogo"
                })
            }
        },
        new ReleaseInfo
        {
            Version = "2.0.0",
            Date = new DateTime(2025, 12, 21),
            Emoji = "üéâ",
            IsMajor = true,
            Title = "Autenticazione Multi-Famiglia",
            Sections = new List<ReleaseSection>
            {
                new("üîê", "Autenticazione & Utenti", new List<string>
                {
                    "Sistema di login/registrazione completo",
                    "Supporto multi-famiglia con dati isolati",
                    "Ruoli utente: Admin e Member",
                    "Gestione membri della famiglia",
                    "Setup iniziale guidato"
                }),
                new("üì¶", "Import/Export", new List<string>
                {
                    "Export completo in JSON (backup)",
                    "Export CSV per snapshots, investimenti, obiettivi",
                    "Import intelligente con anteprima",
                    "Opzione sovrascrittura dati esistenti"
                }),
                new("üìä", "Portafogli di Investimento", new List<string>
                {
                    "Portafogli distinti (PAC, Crypto, etc.)",
                    "Orizzonte temporale e anno target",
                    "Colori personalizzabili",
                    "Portafogli collassabili nella dashboard"
                }),
                new("üéØ", "Obiettivi Avanzati", new List<string>
                {
                    "Priorit√† con badge colorati",
                    "Allocazione manuale dei fondi",
                    "Proiezione mensile per raggiungere l'obiettivo",
                    "Visualizzazione obiettivi completati/in ritardo"
                }),
                new("üõ°Ô∏è", "Previdenza & Assicurazioni", new List<string>
                {
                    "Tab dedicata nella dashboard",
                    "Tracciamento contributi vs valore attuale",
                    "Calcolo gain/loss e performance %"
                }),
                new("üé®", "UI/UX", new List<string>
                {
                    "Design rinnovato con Tailwind CSS",
                    "Tema Dark/Light con persistenza",
                    "Layout responsive",
                    "Localizzazione IT/EN"
                }),
                new("üìù", "Sistema di Logging", new List<string>
                {
                    "Log su file giornalieri",
                    "Pagina Log di Sistema",
                    "Dettagli errori per debug"
                })
            }
        },
        new ReleaseInfo
        {
            Version = "1.0.0",
            Date = new DateTime(2025, 12, 20),
            Emoji = "üöÄ",
            IsMajor = false,
            Title = "Release Iniziale",
            Sections = new List<ReleaseSection>
            {
                new("‚ú®", "Funzionalit√†", new List<string>
                {
                    "Gestione snapshots mensili",
                    "Accounts con categorie",
                    "Investimenti con broker e valore",
                    "Crediti in sospeso",
                    "Obiettivi finanziari base",
                    "Grafici patrimonio nel tempo",
                    "Database SQLite locale"
                })
            }
        }
    };

    List<ReleaseInfo> GetEnglishReleases() => new()
    {
        new ReleaseInfo
        {
            Version = "2.5.0",
            Date = new DateTime(2025, 12, 21),
            Emoji = "üöÄ",
            IsMajor = true,
            Title = "Open Source Ready",
            Sections = new List<ReleaseSection>
            {
                new("üìö", "Documentation", new List<string>
                {
                    "Professional README.md with badges and guides",
                    "CONTRIBUTING.md for contributors",
                    "MIT License",
                    "Environment configuration with env.example"
                }),
                new("üê≥", "DevOps", new List<string>
                {
                    "Optimized multi-stage Dockerfile",
                    "docker-compose.yml for easy deployment",
                    "Automated GitHub Actions CI/CD",
                    "Health check endpoint for containers"
                }),
                new("üß™", "Testing", new List<string>
                {
                    "New test project with xUnit",
                    "25 unit tests for core services",
                    "InMemory database for isolated tests"
                })
            }
        },
        new ReleaseInfo
        {
            Version = "2.4.0",
            Date = new DateTime(2025, 12, 21),
            Emoji = "üìà",
            IsMajor = true,
            Title = "Projections & Forecasting",
            Sections = new List<ReleaseSection>
            {
                new("üîÆ", "Planning Tool", new List<string>
                {
                    "Trend analysis: average monthly growth and percentage rate",
                    "Projection chart: historical + estimated future (1-10 years)",
                    "'When will I reach?' calculator: estimated date for target amount",
                    "Goals timeline with estimated completion dates"
                }),
                new("üßÆ", "What-If Simulator", new List<string>
                {
                    "Simulate additional monthly contributions",
                    "Future value calculation with compound interest",
                    "Shows estimated growth vs contributions made",
                    "Projections up to 20 years"
                }),
                new("üìä", "Financial Calculations", new List<string>
                {
                    "Compound monthly growth rate from history",
                    "Annuity formula for periodic contributions",
                    "Logarithmic projection for time-to-goal"
                })
            }
        },
        new ReleaseInfo
        {
            Version = "2.3.0",
            Date = new DateTime(2025, 12, 21),
            Emoji = "üìä",
            IsMajor = false,
            Title = "Monthly Comparison",
            Sections = new List<ReleaseSection>
            {
                new("üìà", "Comparison Dashboard", new List<string>
                {
                    "Select two snapshots for comparison",
                    "Summary cards: total, variation, growth %",
                    "Bar chart for category comparison",
                    "'What changed' section: increases vs decreases"
                }),
                new("üìã", "Detailed Tables", new List<string>
                {
                    "Category comparison with delta and percentages",
                    "Account/investment level details",
                    "Automatic sorting by amount"
                })
            }
        },
        new ReleaseInfo
        {
            Version = "2.2.0",
            Date = new DateTime(2025, 12, 21),
            Emoji = "üèóÔ∏è",
            IsMajor = true,
            Title = "Architecture Refactoring",
            Sections = new List<ReleaseSection>
            {
                new("üîß", "Service Architecture", new List<string>
                {
                    "New service interfaces (ISnapshotService, IAccountService, etc.)",
                    "Domain-specific services for each functional area",
                    "FinanceService as facade for backward compatibility"
                }),
                new("üß©", "Dashboard Components", new List<string>
                {
                    "New reusable components (NetWorthCards, Charts, etc.)",
                    "Better separation of concerns",
                    "More maintainable and testable code"
                }),
                new("üóëÔ∏è", "Code Cleanup", new List<string>
                {
                    "Removed demo files (Counter, FetchData, Weather)",
                    "Removed unnecessary comments",
                    "Multi-tenancy enforced with required familyId"
                })
            }
        },
        new ReleaseInfo
        {
            Version = "2.1.1",
            Date = new DateTime(2025, 12, 21),
            Emoji = "üîß",
            IsMajor = false,
            Title = "Fix Export/Import Budget",
            Sections = new List<ReleaseSection>
            {
                new("üì¶", "Export/Import", new List<string>
                {
                    "JSON export now includes budget categories and monthly expenses",
                    "Import preview shows budget category count",
                    "Import with correct ID mapping for categories",
                    "Backup format version updated to 2.0"
                })
            }
        },
        new ReleaseInfo
        {
            Version = "2.1.0",
            Date = new DateTime(2025, 12, 21),
            Emoji = "üí∞",
            IsMajor = false,
            Title = "Budget & Monthly Expenses",
            Sections = new List<ReleaseSection>
            {
                new("üìä", "Budget System", new List<string>
                {
                    "New Budget Management page for expense categories",
                    "Default categories with one click (Housing, Groceries, Transport...)",
                    "Configurable monthly budget per category",
                    "Customizable emoji icons and colors"
                }),
                new("üí≥", "Expense Tracking", new List<string>
                {
                    "Monthly Expenses section in SnapshotEdit",
                    "Progress bar for each category",
                    "Visual highlight when over budget",
                    "Budget tab in Dashboard with summary"
                })
            }
        },
        new ReleaseInfo
        {
            Version = "2.0.0",
            Date = new DateTime(2025, 12, 21),
            Emoji = "üéâ",
            IsMajor = true,
            Title = "Multi-Family Authentication",
            Sections = new List<ReleaseSection>
            {
                new("üîê", "Authentication & Users", new List<string>
                {
                    "Complete login/registration system",
                    "Multi-family support with isolated data",
                    "User roles: Admin and Member",
                    "Family member management",
                    "Guided initial setup"
                }),
                new("üì¶", "Import/Export", new List<string>
                {
                    "Full JSON export (backup)",
                    "CSV export for snapshots, investments, goals",
                    "Smart import with preview",
                    "Option to overwrite existing data"
                }),
                new("üìä", "Investment Portfolios", new List<string>
                {
                    "Distinct portfolios (DCA, Crypto, etc.)",
                    "Time horizon and target year",
                    "Customizable colors",
                    "Collapsible portfolios in dashboard"
                }),
                new("üéØ", "Advanced Goals", new List<string>
                {
                    "Priority with colored badges",
                    "Manual fund allocation",
                    "Monthly projection to reach goal",
                    "Completed/overdue goals visualization"
                }),
                new("üõ°Ô∏è", "Pension & Insurance", new List<string>
                {
                    "Dedicated dashboard tab",
                    "Contribution vs current value tracking",
                    "Gain/loss and performance % calculation"
                }),
                new("üé®", "UI/UX", new List<string>
                {
                    "Redesigned with Tailwind CSS",
                    "Dark/Light theme with persistence",
                    "Responsive layout",
                    "IT/EN localization"
                }),
                new("üìù", "Logging System", new List<string>
                {
                    "Daily log files",
                    "System Logs page",
                    "Error details for debugging"
                })
            }
        },
        new ReleaseInfo
        {
            Version = "1.0.0",
            Date = new DateTime(2025, 12, 20),
            Emoji = "üöÄ",
            IsMajor = false,
            Title = "Initial Release",
            Sections = new List<ReleaseSection>
            {
                new("‚ú®", "Features", new List<string>
                {
                    "Monthly snapshot management",
                    "Accounts with categories",
                    "Investments with broker and value",
                    "Pending credits",
                    "Basic financial goals",
                    "Wealth charts over time",
                    "Local SQLite database"
                })
            }
        }
    };

    class ReleaseInfo
    {
        public string Version { get; set; } = "";
        public DateTime Date { get; set; }
        public string Emoji { get; set; } = "üì¶";
        public bool IsMajor { get; set; }
        public string? Title { get; set; }
        public List<ReleaseSection> Sections { get; set; } = new();
    }

    class ReleaseSection
    {
        public string Icon { get; set; } = "‚ú®";
        public string Title { get; set; } = "";
        public List<string> Items { get; set; } = new();

        public ReleaseSection() { }
        public ReleaseSection(string icon, string title, List<string> items)
        {
            Icon = icon;
            Title = title;
            Items = items;
        }
    }
}
