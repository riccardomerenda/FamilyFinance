@page "/_Host"
@using Microsoft.AspNetCore.Components.Web
@namespace FamilyFinance.Pages
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="~/" />
    <title>FamilyFinance</title>
    
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                            950: '#1e1b4b',
                        },
                        accent: {
                            50: '#ecfeff',
                            100: '#cffafe',
                            200: '#a5f3fc',
                            300: '#67e8f9',
                            400: '#22d3ee',
                            500: '#06b6d4',
                            600: '#0891b2',
                            700: '#0e7490',
                            800: '#155e75',
                            900: '#164e63',
                        }
                    },
                    fontFamily: {
                        sans: ['Outfit', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    
    <!-- Outfit Font (more distinctive than Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Heroicons -->
    <script src="https://unpkg.com/@@heroicons/vue@2.0.18/dist/cjs/index.cjs" defer></script>
    
    <!-- Custom styles -->
    <style>
        * { font-family: 'Outfit', system-ui, sans-serif; }
        
        /* Smooth transitions for theme changes */
        html { transition: background-color 0.3s ease, color 0.3s ease; }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #6366f1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #4f46e5; }
        
        /* Glassmorphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .dark .glass {
            background: rgba(17, 24, 39, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Bento card base */
        .bento-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .dark .bento-card {
            background: rgba(17, 24, 39, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .bento-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }
        .dark .bento-card:hover {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
        }
        
        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, #6366f1 0%, #06b6d4 50%, #10b981 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Money display with mono font */
        .money { font-family: 'JetBrains Mono', monospace; letter-spacing: -0.02em; }
        
        /* Hero gradient backgrounds */
        .hero-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #6B8DD6 100%);
        }
        .hero-gradient-emerald {
            background: linear-gradient(135deg, #059669 0%, #10b981 50%, #34d399 100%);
        }
        .hero-gradient-amber {
            background: linear-gradient(135deg, #d97706 0%, #f59e0b 50%, #fbbf24 100%);
        }
        
        /* Mesh gradient background */
        .mesh-bg {
            background-color: #f8fafc;
            background-image: 
                radial-gradient(at 40% 20%, rgba(99, 102, 241, 0.1) 0px, transparent 50%),
                radial-gradient(at 80% 0%, rgba(6, 182, 212, 0.1) 0px, transparent 50%),
                radial-gradient(at 0% 50%, rgba(16, 185, 129, 0.1) 0px, transparent 50%),
                radial-gradient(at 80% 50%, rgba(245, 158, 11, 0.05) 0px, transparent 50%),
                radial-gradient(at 0% 100%, rgba(99, 102, 241, 0.08) 0px, transparent 50%);
        }
        .dark .mesh-bg {
            background-color: #030712;
            background-image: 
                radial-gradient(at 40% 20%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                radial-gradient(at 80% 0%, rgba(6, 182, 212, 0.1) 0px, transparent 50%),
                radial-gradient(at 0% 50%, rgba(16, 185, 129, 0.08) 0px, transparent 50%),
                radial-gradient(at 80% 50%, rgba(245, 158, 11, 0.05) 0px, transparent 50%);
        }
        
        /* Staggered animation */
        @@keyframes fadeSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in {
            animation: fadeSlideUp 0.5s ease-out forwards;
            opacity: 0;
        }
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }
        .delay-5 { animation-delay: 0.5s; }
        
        /* Glow effects */
        .glow-primary { box-shadow: 0 0 40px rgba(99, 102, 241, 0.3); }
        .glow-emerald { box-shadow: 0 0 40px rgba(16, 185, 129, 0.3); }
        .glow-amber { box-shadow: 0 0 40px rgba(245, 158, 11, 0.3); }
        
        /* Card hover effect (legacy) */
        .card-hover {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.15);
        }
        
        /* Progress bar animation */
        @@keyframes progressFill {
            from { width: 0%; }
        }
        .progress-animated {
            animation: progressFill 1s ease-out forwards;
        }
        
        /* Slide in animation for tour */
        @@keyframes slideInFromBottom {
            from { opacity: 0; transform: translateY(16px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in-from-bottom-4 {
            animation: slideInFromBottom 0.3s ease-out forwards;
        }
        
        /* Hide Blazor error UI */
        #blazor-error-ui { display: none; }
    </style>
    
    <link rel="icon" type="image/png" href="favicon.png"/>
    <component type="typeof(HeadOutlet)" render-mode="ServerPrerendered" />
</head>
<body class="bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100 min-h-screen">
    <component type="typeof(App)" render-mode="ServerPrerendered" />

    <div id="blazor-error-ui">
        <environment include="Staging,Production">
            An error has occurred. This application may no longer respond until reloaded.
        </environment>
        <environment include="Development">
            An unhandled exception has occurred. See browser dev tools for details.
        </environment>
        <a href="" class="reload">Reload</a>
        <a class="dismiss">🗙</a>
    </div>

    <script src="_framework/blazor.server.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="js/chartInterop.js"></script>
    <script src="js/download.js"></script>
    
    <script>
        // Theme management
        function setTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            }
        }
        
        function toggleTheme() {
            const isDark = document.documentElement.classList.contains('dark');
            setTheme(isDark ? 'light' : 'dark');
            return !isDark;
        }
        
        function getTheme() {
            return document.documentElement.classList.contains('dark') ? 'dark' : 'light';
        }
        
        // Initialize theme from localStorage or system preference
        (function() {
            const stored = localStorage.getItem('theme');
            if (stored) {
                setTheme(stored);
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                setTheme('dark');
            } else {
                setTheme('light');
            }
        })();
        
        // Language switch function
        function switchLanguage(culture) {
            var currentPath = window.location.pathname;
            if (!currentPath || currentPath === '') currentPath = '/';
            window.location.href = '/Culture/Set/' + culture + '?returnUrl=' + encodeURIComponent(currentPath);
        }
        
        // Guided Tour functions
        function getTourElementRect(selector) {
            const element = document.querySelector(selector);
            if (!element) {
                console.warn('Tour: Element not found:', selector);
                return null;
            }
            
            // Make sure element is visible
            const style = window.getComputedStyle(element);
            if (style.display === 'none' || style.visibility === 'hidden') {
                console.warn('Tour: Element hidden:', selector);
                return null;
            }
            
            const rect = element.getBoundingClientRect();
            
            // Check if element has actual dimensions
            if (rect.width === 0 || rect.height === 0) {
                console.warn('Tour: Element has no dimensions:', selector, rect);
                return null;
            }
            
            console.log('Tour: Element found:', selector, rect);
            
            // Return viewport-relative coordinates for position:fixed elements
            return {
                top: rect.top,
                left: rect.left,
                right: rect.right,
                bottom: rect.bottom,
                width: rect.width,
                height: rect.height,
                viewportWidth: window.innerWidth,
                viewportHeight: window.innerHeight
            };
        }
        
        async function scrollTourElementIntoView(selector) {
            const element = document.querySelector(selector);
            if (element) {
                // Scroll with some offset to ensure element is well visible
                element.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
                // Wait for scroll to complete
                await new Promise(resolve => setTimeout(resolve, 300));
            }
        }
        
        // Help Tooltip functions - renders tooltip to body for proper z-index
        let helpTooltipElement = null;
        let helpTooltipBackdrop = null;
        
        function showHelpTooltip(buttonElement, title, content, buttonText) {
            hideHelpTooltip(); // Clean up any existing
            
            const rect = buttonElement.getBoundingClientRect();
            const isDark = document.documentElement.classList.contains('dark');
            
            // Create backdrop
            helpTooltipBackdrop = document.createElement('div');
            helpTooltipBackdrop.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;z-index:99998;';
            helpTooltipBackdrop.onclick = hideHelpTooltip;
            document.body.appendChild(helpTooltipBackdrop);
            
            // Create tooltip
            helpTooltipElement = document.createElement('div');
            
            // Calculate position
            let top = rect.bottom + 8;
            let left = rect.left;
            const tooltipWidth = 288;
            
            // Keep within viewport
            if (left + tooltipWidth > window.innerWidth - 16) {
                left = window.innerWidth - tooltipWidth - 16;
            }
            if (left < 16) left = 16;
            if (top + 200 > window.innerHeight) {
                top = rect.top - 200 - 8; // Show above if not enough space below
            }
            
            const bgColor = isDark ? '#1f2937' : '#ffffff';
            const borderColor = isDark ? '#374151' : '#e5e7eb';
            const textColor = isDark ? '#d1d5db' : '#4b5563';
            const btnBgColor = isDark ? '#374151' : '#f3f4f6';
            const btnTextColor = isDark ? '#d1d5db' : '#374151';
            
            helpTooltipElement.style.cssText = `position:fixed;top:${top}px;left:${left}px;width:${tooltipWidth}px;z-index:99999;font-family:Outfit,system-ui,sans-serif;`;
            helpTooltipElement.innerHTML = `
                <div style="background:${bgColor};border-radius:12px;box-shadow:0 25px 50px -12px rgba(0,0,0,0.4);border:1px solid ${borderColor};overflow:hidden;">
                    <div style="background:linear-gradient(to right,#6366f1,#8b5cf6);padding:8px 16px;display:flex;align-items:center;justify-content:space-between;">
                        <div style="display:flex;align-items:center;gap:8px;">
                            <svg style="width:16px;height:16px;color:white;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span style="color:white;font-weight:500;font-size:14px;">${title}</span>
                        </div>
                        <button onclick="hideHelpTooltip()" style="color:rgba(255,255,255,0.7);background:none;border:none;cursor:pointer;padding:4px;">
                            <svg style="width:16px;height:16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    <div style="padding:16px;">
                        <p style="color:${textColor};font-size:14px;line-height:1.6;margin:0;">${content}</p>
                    </div>
                    <div style="padding:0 16px 12px;">
                        <button onclick="hideHelpTooltip()" style="width:100%;padding:8px;background:${btnBgColor};color:${btnTextColor};border:none;border-radius:8px;font-weight:500;font-size:14px;cursor:pointer;">
                            ${buttonText}
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(helpTooltipElement);
        }
        
        function hideHelpTooltip() {
            if (helpTooltipBackdrop) {
                helpTooltipBackdrop.remove();
                helpTooltipBackdrop = null;
            }
            if (helpTooltipElement) {
                helpTooltipElement.remove();
                helpTooltipElement = null;
            }
        }
    </script>
</body>
</html>
